# 牆量計算工具 - 使用說明

## 🚀 快速開始

### 1. 啟動伺服器

在專案目錄下執行：

```bash
python app.py
```

伺服器會啟動在 http://localhost:5000

### 2. 開啟網頁

用瀏覽器打開：http://localhost:5000

## 📋 操作步驟

### 步驟 1：上傳 DXF 檔案

1. 點擊「📁 上傳 DXF 檔案」按鈕
2. 選擇你的 DXF 檔案（支援最大 500MB）
3. 等待上傳和解析完成（可能需要 1-3 分鐘）
4. 看到「載入成功」訊息

### 步驟 2：查看結果

上傳成功後，你會看到：

**左側面板 - 圖層列表（前 20 名）**
```
📋 圖層列表 (441 個圖層)

室外停車-範圍
17,136 條線段, 217.70m

_立面圖立面圖框
13,257 條線段, 248.96m

柱表
8,288 條線段, 847.03m

...
```

**右側面板 - 統計資訊**
```
檔案資訊
檔案名稱: 白鷺安居-建築底圖_1141121.dxf
圖層數量: 441
線段總數: 118,642

圖層統計（前 20 名）
圖層              線段數      長度(m)
室外停車-範圍     17,136      217.70
_立面圖立面圖框   13,257      248.96
柱表              8,288       847.03
TOIL              6,837       94.40
0                 5,896       186.51
WALL-15CM         5,231       1,092.90
WALL-牆           3,914       421.68
...
```

**中間 - Canvas 顯示區域**
- 目前還沒實作繪圖功能
- 將來會顯示所有線段的平面圖

### 步驟 3：選擇要計算的圖層（未來功能）

1. 點擊「📋 選擇計算圖層」按鈕
2. 在彈出視窗輸入圖層名稱（一行一個）：
   ```
   WALL-牆
   WALL-15CM
   WALL-18CM
   ```
3. 點擊確定

### 步驟 4：匯出 CSV（未來功能）

1. 點擊「📄 匯出 CSV」按鈕
2. 下載 CSV 檔案
3. 用 Excel 開啟或匯入公司試算表

## ✅ 目前可用功能

| 功能 | 狀態 | 說明 |
|------|------|------|
| 上傳 DXF | ✅ 可用 | 支援最大 500MB |
| 解析 DXF | ✅ 可用 | 成功測試 138MB 檔案，118,642 條線段 |
| 顯示統計資訊 | ✅ 可用 | 右側面板顯示檔案資訊和圖層統計 |
| 顯示圖層列表 | ✅ 可用 | 左側面板顯示圖層（前 20 名） |
| Canvas 繪圖 | ❌ 未實作 | 目前只有空白畫布 |
| 圖層選擇 | ❌ 未實作 | 按鈕已隱藏 |
| 匯出 CSV | ❌ 未實作 | 按鈕已隱藏 |

## 🧪 測試結果

已成功測試的檔案：

### 1. 小型測試檔案
- 檔案：test_sample.dxf
- 大小：20KB
- 線段：6 條
- 結果：✅ 成功

### 2. 中型測試檔案
- 檔案：白鷺-建築底圖 上構測試用.dxf
- 大小：95MB
- 線段：25,726 條
- 圖層：441 個
- 結果：✅ 成功

### 3. 大型完整檔案
- 檔案：白鷺安居-建築底圖_1141121.dxf
- 大小：138MB
- 線段：**118,642 條**
- 圖層：441 個
- 主要牆圖層：
  - WALL-15CM：5,231 條 (1,092.90m)
  - WALL-牆：3,914 條 (421.68m)
  - WALL-18CM：2,797 條 (501.91m)
- 結果：✅ 成功

## ⚠️ 注意事項

1. **上傳時間**
   - 小檔案（<10MB）：幾秒鐘
   - 中型檔案（10-100MB）：1-2 分鐘
   - 大型檔案（100-200MB）：2-3 分鐘
   - 請耐心等待，不要重複點擊

2. **瀏覽器要求**
   - 建議使用 Chrome、Edge 或 Firefox
   - 需要啟用 JavaScript

3. **檔案大小限制**
   - 最大 500MB
   - 如果你的檔案超過這個大小，請聯繫開發者

4. **錯誤處理**
   - 如果上傳失敗，檢查瀏覽器的開發者工具（F12）查看錯誤訊息
   - 確認伺服器正在運行（http://localhost:5000 應該可以訪問）

## 🔧 開發者資訊

### API 端點

| 方法 | 端點 | 說明 |
|------|------|------|
| POST | `/api/upload` | 上傳 DXF 檔案 |
| POST | `/api/parse` | 解析 DXF 並返回資料 |
| GET | `/api/projects/<id>/export/csv` | 匯出 CSV（未來） |

### 回傳資料格式

```json
{
  "success": true,
  "project_id": 4,
  "total_segment_count": 118642,
  "layers": {
    "WALL-牆": {
      "name": "WALL-牆",
      "color": 2,
      "is_on": true,
      "is_frozen": false,
      "status": "ON"
    },
    ...
  },
  "segments": [
    {
      "id": "seg_00001",
      "layer": "WALL-牆",
      "entity_type": "LINE",
      "start_point": [0, 0],
      "end_point": [1000, 0],
      "length": 1000.0
    },
    ...
  ]
}
```

### 資料庫

- SQLite 資料庫：`wall_calculator.db`
- 上傳檔案儲存在：`uploads/` 目錄

## 📝 待辦事項

1. ✅ 後端 API 完成
2. ✅ 上傳和解析功能
3. ✅ 統計資訊顯示
4. ✅ 圖層列表顯示
5. ❌ Canvas 繪圖功能
6. ❌ 圖層選擇視窗
7. ❌ CSV 匯出功能
8. ❌ 圖層顯示/隱藏切換
9. ❌ 縮放和平移功能
10. ❌ 圖層篩選和搜尋

## 📞 支援

如有問題，請檢查：
1. 伺服器是否正在運行
2. 瀏覽器開發者工具（F12）的 Console 標籤
3. 伺服器終端的錯誤訊息
