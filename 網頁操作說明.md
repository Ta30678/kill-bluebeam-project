# 牆量計算工具 - 網頁操作說明

## 目前網頁功能狀態

### ✅ 已實現的功能

1. **基本界面佈局**
   - 頂部：上傳按鈕和檔案狀態
   - 左側：圖層列表面板（待實作顯示功能）
   - 中間：Canvas 繪圖區域
   - 右側：統計資訊面板
   - 底部：狀態列

2. **Canvas 工具**
   - 選取工具（⬚）
   - 平移工具（✋）
   - 放大/縮小（🔍+/🔍-）
   - 適合視窗（⛶）
   - 滑鼠滾輪縮放
   - 右鍵拖曳平移

### ⚠️ 待實作的功能

以下功能的後端 API 已經完成，但前端 JavaScript 尚未實作：

1. **檔案上傳流程**
   - ❌ 點擊「上傳 DXF 檔案」按鈕
   - ❌ 呼叫 `/api/upload` 上傳檔案
   - ❌ 呼叫 `/api/parse` 解析 DXF
   - ❌ 接收並顯示所有線段資料

2. **圖層列表顯示**
   - ❌ 顯示所有 441 個圖層
   - ❌ 每個圖層顯示線段數量和總長度
   - ❌ 圖層點擊可切換顯示/隱藏

3. **平面圖顯示**
   - ❌ 在 Canvas 上繪製所有 25,726 條線段
   - ❌ 使用不同顏色區分圖層
   - ❌ 自動縮放以適合視窗

4. **統計資訊**
   - ❌ 顯示檔案名稱
   - ❌ 顯示圖層數量
   - ❌ 顯示線段總數
   - ❌ 顯示各圖層統計（前 10 名）

5. **圖層選擇功能**（未來）
   - ❌ 開啟圖層選擇視窗
   - ❌ 讓使用者輸入要計算的圖層名稱
   - ❌ 支援多個圖層輸入
   - ❌ 根據選擇的圖層計算統計

## 理想的操作流程（目標）

### 步驟 1：上傳 DXF 檔案
1. 點擊「📁 上傳 DXF 檔案」按鈕
2. 選擇 DXF 檔案（支援最大 500MB）
3. 系統自動上傳並解析
4. 顯示進度提示：「上傳中...」→「解析中...」→「完成」

### 步驟 2：查看完整平面圖
1. 解析完成後，Canvas 自動顯示所有線段
2. 左側圖層列表顯示所有圖層：
   ```
   📋 圖層列表 (441 個圖層)

   ☑ WALL-牆 (2,012 條線段, 230.76m)
   ☑ WALL-15CM (1,238 條線段, 236.10m)
   ☑ WALL-18CM (1,222 條線段, 136.10m)
   ☑ _立面圖 (3,363 條線段, 60.14m)
   ...
   ```
3. 右側統計面板顯示檔案資訊：
   ```
   檔案資訊
   檔案名稱: 白鷺-建築底圖 上構測試用.dxf
   圖層數量: 441
   線段總數: 25,726

   圖層統計（前 10 名）
   圖層          線段數    長度(m)
   _立面圖       3,363     60.14
   WALL-牆       2,012     230.76
   WALL-15CM     1,238     236.10
   ...
   ```

### 步驟 3：選擇要計算的圖層（未來功能）
1. 點擊「📋 選擇計算圖層」按鈕
2. 彈出視窗讓使用者輸入圖層名稱：
   ```
   請輸入要納入計算的圖層名稱（一行一個）：

   [文字框]
   WALL-牆
   WALL-15CM
   WALL-18CM

   [確定] [取消]
   ```
3. 點擊確定後，只計算選中圖層的統計
4. 「📄 匯出 CSV」按鈕啟用

### 步驟 4：匯出統計結果
1. 點擊「📄 匯出 CSV」按鈕
2. 下載 CSV 檔案，包含選中圖層的統計資料
3. 可匯入 Excel 或公司試算表

## Canvas 操作說明

### 滑鼠操作
- **滑鼠滾輪**：縮放
- **右鍵拖曳**：平移
- **左鍵點擊**：選取線段（未實作）
- **Shift + 左鍵**：多選線段（未實作）

### 工具列按鈕
- **⬚ 選取**：選取模式
- **✋ 平移**：拖曳平移畫布
- **🔍+ 放大**：放大視圖
- **🔍- 縮小**：縮小視圖
- **⛶ 適合視窗**：自動縮放以顯示所有內容

## 技術細節

### API 端點
- `POST /api/upload` - 上傳 DXF 檔案
- `POST /api/parse` - 解析 DXF 並返回所有線段資料
- `GET /api/projects/<id>/export/csv` - 匯出 CSV

### 回傳資料格式
```json
{
  "success": true,
  "project_id": 3,
  "total_segment_count": 25726,
  "layers": {
    "WALL-牆": {
      "name": "WALL-牆",
      "color": 2,
      "is_on": true,
      "is_frozen": false,
      "status": "ON"
    },
    ...
  },
  "segments": [
    {
      "id": "seg_00001",
      "layer": "WALL-牆",
      "entity_type": "LINE",
      "start_point": [0, 0],
      "end_point": [1000, 0],
      "length": 1000.0
    },
    ...
  ]
}
```

### 預期的畫面效果
- 所有 25,726 條線段都顯示在 Canvas 上
- 不同圖層用不同顏色（或同色）顯示
- 可以縮放和平移查看細節
- 左側可以勾選/取消圖層的顯示
- 右側即時顯示統計資訊

## 下一步開發

1. **實作上傳功能的 JavaScript**
   - 綁定上傳按鈕事件
   - 呼叫 API
   - 處理回傳資料

2. **實作 Canvas 繪圖**
   - 解析線段資料
   - 繪製所有線段
   - 實作縮放和平移

3. **實作圖層列表**
   - 動態生成圖層清單
   - 顯示線段數和長度
   - 實作勾選/取消功能

4. **實作統計面板**
   - 顯示檔案資訊
   - 顯示圖層統計
   - 更新統計資料

5. **實作圖層選擇視窗**
   - 彈出視窗 UI
   - 多行文字輸入
   - 根據選擇更新統計
